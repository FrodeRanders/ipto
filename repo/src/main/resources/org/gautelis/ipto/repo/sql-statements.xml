<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>
        OBSERVE:
        Corresponds to class org.gautelis.ipto.repo.model.Statements
    </comment>

    <!--
      Get all tenants from repo_tenant table.
    -->
    <entry key="sql.tenant.get_all">
        SELECT tenantid, name, description, created FROM repo_tenant
    </entry>

    <!--
      Delete a specific unit from repo_unit table and cascades to
        repo_attribute_value, repo_string_vector, repo_time_vector,
        repo_integer_vector, repo_long_vector, repo_double_vector,
        repo_boolean_vector, repo_data_vector,
        repo_lock, repo_internal_assoc, repo_external_assoc
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.delete">
        DELETE FROM repo_unit_kernel WHERE (tenantid=? AND unitid=?)
    </entry>
    
    <!--
      Check existence of unit, regardless of status.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.exists">
        SELECT tenantid, unitid FROM repo_unit_kernel WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Get status of unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.get_status">
        SELECT status FROM repo_unit_kernel WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Get latest version of unit.
      Call with: (tenantId, unitId, unitVersion)
    -->
    <entry key="sql.unit.get">
        SELECT uk.tenantid, uk.unitid, uk.corrid, uk.status, uk.lastver, uk.created, uv.unitver, uv.unitname, uv.modified
        FROM repo_unit_kernel uk
        INNER JOIN repo_unit_version uv
            ON (uk.tenantid = uv.tenantid AND uk.unitid = uv.unitid)
        WHERE (uk.tenantid=? AND uk.unitid=? AND uv.unitver=?)
    </entry>

    <!--
      Get latest version of unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.get_latest">
        SELECT uk.tenantid, uk.unitid, uk.corrid, uk.status, uk.lastver, uk.created, uv.unitver, uv.unitname, uv.modified
        FROM repo_unit_kernel uk
        INNER JOIN repo_unit_version uv
            ON (uk.tenantid = uv.tenantid AND uk.unitid = uv.unitid AND uk.lastver = uv.unitver)
        WHERE (uk.tenantid=? AND uk.unitid=?)
    </entry>

    <!--
      Set/update status of unit.
      Call with: (status, tenantId, unitId)
    -->
    <entry key="sql.unit.set_status">
        UPDATE repo_unit_kernel SET status=? WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Find all attributes associated with a specific version of a unit.
      Values in the value vector are returned in ascending index order.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.get_attributes">
        SELECT * FROM load_unit_vectors(?, ?)
    </entry>

    <!--
      Bind a specific unit to a specific version of an attribute and it's value.
      Call with: (tenantId, unitId, attrId)
      A valueId will be generated.
    -->
    <entry key="sql.unit.attribute.add">
        INSERT INTO repo_attribute_value (tenantid,unitid,attrid) VALUES (?,?,?)
    </entry>

    <!--
      Delete all attributes associated with a unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.unit.attribute.remove">
        DELETE FROM repo_attribute_value WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Get all available attributes.
    -->
    <entry key="sql.attribute.get_all">
        SELECT attrid, qualname, attrname, alias, attrtype, scalar, created FROM repo_attribute
    </entry>

    <!--
      Create attribute
    -->
    <entry key="sql.attribute.create">
        INSERT INTO repo_attribute (attrtype, scalar, attrname, qualname, alias) VALUES (?,?,?,?,?)
    </entry>


    <!--
      Attribute is in use
    -->
    <entry key="sql.attribute.in_use">
        SELECT 1 FROM repo_attribute_value WHERE attrid = ? FETCH FIRST 1 ROWS ONLY
    </entry>

    <!--
      Delete entry for unit from the lock table.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.lock.delete_all">
        DELETE FROM repo_lock WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Get all locks for a unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.lock.get_all">
        SELECT * FROM repo_lock WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Insert entry into the lock table.
      Call with: (tenantId, unitId, purpose, lockType, expireTime)
    -->
    <entry key="sql.lock.insert">
        INSERT INTO repo_lock (tenantid,unitid,purpose,locktype,expire) VALUES (?,?,?,?,?)
    </entry>

    <!--
      Get log entries for specific unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.log.get_entries">
        SELECT tenantid, unitid, unitver, event, logentry, logtime
        FROM repo_log
        WHERE (tenantid=? AND unitid=?) ORDER BY logtime ASC
    </entry>

    <!--
      Delete entries in the (audit) log for specific unit (tenantId, unitId).
      If entries are to be left behind, the foreign key constraint has to be removed!
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.log.delete_entries">
        DELETE FROM repo_log WHERE (tenantid=? AND unitid=?)
    </entry>

    <!--
      Count all external left associations for specified external entity.
      Call with: (assocType, assocString)
    -->
    <entry key="sql.assoc.count_left_external_assocs">
        SELECT COUNT(*) FROM repo_external_assoc WHERE assoctype=? AND assocstring=?
    </entry>

    <!--
      Count all internal left relations for specified unit.
      Call with: (relType, relTenantId, relUnitId)
    -->
    <entry key="sql.relation.count_left_internal_relations">
        SELECT COUNT(*) FROM repo_internal_relation WHERE reltype=? AND reltenantid=? AND relunitid=?
    </entry>

    <!--
      Count all external right associations for specified unit.
      Call with: (tenantId, unitId, assocType)
    -->
    <entry key="sql.assoc.count_right_external_assocs">
        SELECT COUNT(*) FROM repo_external_assoc WHERE tenantid=? AND unitid=? and assoctype=?
    </entry>

    <!--
      Count all internal right relations for specified unit.
      Call with: (tenantId, unitId, relType)
    -->
    <entry key="sql.relation.count_right_internal_relations">
        SELECT COUNT(*) FROM repo_internal_relation WHERE tenantid=? AND unitid=? and reltype=?
    </entry>

    <!--
      Get all left external associations.
      Call with: (assocType, assocString)
    -->
    <entry key="sql.assoc.get_all_left_external_assocs">
        SELECT tenantid, unitid, assoctype, assocstring, associd FROM repo_external_assoc WHERE assoctype=? AND assocstring=?
    </entry>

    <!--
      Get all left internal relations.
      Call with: (relType, relTenantId, relUnitId)
    -->
    <entry key="sql.relation.get_all_left_internal_relations">
        SELECT tenantid, unitid, reltype, reltenantid, relunitid FROM repo_internal_relation WHERE reltype=? AND reltenantid=? AND relunitid=?
    </entry>

    <!--
      Get all right external associations.
      Call with: (tenantId, unitId, assocType)
    -->
    <entry key="sql.assoc.get_all_right_external_assocs">
        SELECT tenantid, unitid, assoctype, assocstring, associd FROM repo_external_assoc WHERE tenantid=? AND unitid=? AND assoctype=?
    </entry>

    <!--
      Get all right internal relations.
      Call with: (tenantId, unitId, relType)
    -->
    <entry key="sql.relation.get_all_right_internal_relations">
        SELECT tenantid, unitid, reltype, reltenantid, relunitid FROM repo_internal_relation WHERE tenantid=? AND unitid=? AND reltype=?
    </entry>

    <!--
      Get all external associations from unit to a specific entity
      Call with: (tenantId, unitId, assocType, assocString)
    -->
    <entry key="sql.assoc.get_all_specific_external_assocs">
        SELECT tenantid, unitid, assoctype, assocstring, associd FROM repo_external_assoc WHERE tenantid=? AND unitid=? AND assoctype=? AND assocstring=?
    </entry>

    <!--
      Get right internal relation.
      Call with: (tenantId, unitId, relType)
    -->
    <entry key="sql.relation.get_right_internal_relation">
        SELECT tenantid, unitid, reltype, reltenantid, relunitid FROM repo_internal_relation WHERE tenantid=? AND unitid=? AND reltype=?
    </entry>

    <!--
      Remove all external associations for specified unit.
      Call with: (tenantId, unitId)
    -->
    <entry key="sql.assoc.remove_all_external_assocs">
        DELETE FROM repo_external_assoc WHERE tenantid=? AND unitid=?
    </entry>

    <!--
      Remove all internal relations for specified unit.
      Call with: (tenantId, unitId, relTenantId, relUnitId)
    -->
    <entry key="sql.relation.remove_all_internal_relations">
        DELETE FROM repo_internal_relation WHERE (tenantid=? AND unitid=?) OR (reltenantid=? AND relunitid=?)
    </entry>

    <!--
      Remove all right external associations for specified unit.
      Call with: (tenantId, unitId, assocType)
    -->
    <entry key="sql.assoc.remove_all_right_external_assocs">
        DELETE FROM repo_external_assoc WHERE tenantid=? AND unitid=? AND assoctype=?
    </entry>

    <!--
      Remove all right internal relation for specified unit.
      Call with: (tenantId, unitId, relType)
    -->
    <entry key="sql.relation.remove_all_right_internal_relations">
        DELETE FROM repo_internal_relation WHERE tenantid=? AND unitid=? AND reltype=?
    </entry>

    <!--
      Remove specific external association.
      Call with: (tenantId, unitId, assocType, assocString)
    -->
    <entry key="sql.assoc.remove_specific_external_assoc">
        DELETE FROM repo_external_assoc WHERE tenantid=? AND unitid=? AND assoctype=? AND assocstring=?
    </entry>

    <!--
      Remove specific internal relation.
      Call with: (tenantId, unitId, relType, relTenantId, relUnitId)
    -->
    <entry key="sql.relation.remove_specific_internal_relation">
        DELETE FROM repo_internal_relation WHERE tenantid=? AND unitid=? AND reltype=? AND reltenantid=? AND relunitid=?
    </entry>

    <!--
      Store external association.
      Call with: (tenantId, unitId, assocType, assocString)
    -->
    <entry key="sql.assoc.store_external_assoc">
        INSERT INTO repo_external_assoc (tenantid, unitid, assoctype, assocstring) VALUES (?, ?, ?, ?)
    </entry>

    <!--
      Store internal relation.
      Call with: (tenantId, unitId, relType, relTenantId, relUnitId)
    -->
    <entry key="sql.relation.store_internal_relation">
        INSERT INTO repo_internal_relation (tenantid, unitid, reltype, reltenantid, relunitid) VALUES (?, ?, ?, ?, ?)
    </entry>
</properties>



