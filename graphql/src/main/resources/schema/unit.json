{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/ipto-unit.schema.json",
  "type": "object",
  "additionalProperties": false,
  "required": ["@type", "@version", "tenantid", "unitid", "unitver", "corrid", "status", "unitname", "created", "modified", "attributes"],
  "properties": {
    "@type": { "const": "ipto:unit" },
    "@version": { "type": "integer", "minimum": 1 },

    "tenantid": { "type": "integer", "minimum": 1 },
    "unitid": {
      "anyOf": [
        { "type": "integer", "minimum": 1 },
        { "type": "null" }
      ]
    },
    "unitver":  {
      "anyOf": [
        { "type": "integer", "minimum": 1 },
        { "type": "null" }
      ]
    },
    "corrid": {
      "anyOf": [
        { "type": "string", "format": "uuid" },
        { "type": "null" }
      ]
    },
    "status": { "type": "integer" },

    "unitname": { "type": "string", "minLength": 1 },
    "created": { "type": "string", "format": "date-time" },
    "modified": { "type": "string", "format": "date-time" },

    "attributes": {
      "type": "array",
      "items": { "$ref": "#/$defs/attribute" }
    }
  },

  "$defs": {
    "prefixedName": {
      "type": "string",
      "pattern": "^(?:[A-Za-z][A-Za-z0-9_\\-]*:|:)[^\\s]+$"
    },

    "base64": {
      "type": "string",
      "pattern": "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$"
    },

    "attribute": {
      "oneOf": [
        { "$ref": "#/$defs/stringScalar" },
        { "$ref": "#/$defs/stringVector" },
        { "$ref": "#/$defs/timeScalar" },
        { "$ref": "#/$defs/timeVector" },
        { "$ref": "#/$defs/integerScalar" },
        { "$ref": "#/$defs/integerVector" },
        { "$ref": "#/$defs/longScalar" },
        { "$ref": "#/$defs/longVector" },
        { "$ref": "#/$defs/doubleScalar" },
        { "$ref": "#/$defs/doubleVector" },
        { "$ref": "#/$defs/booleanScalar" },
        { "$ref": "#/$defs/booleanVector" },
        { "$ref": "#/$defs/dataScalar" },
        { "$ref": "#/$defs/dataVector" },
        { "$ref": "#/$defs/recordScalar" },
        { "$ref": "#/$defs/recordVector" }
      ]
    },

    "stringScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:string-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "STRING" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "value": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "stringVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:string-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "STRING" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "value": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 0
        }
      }
    },

    "timeScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:time-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "TIME" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "value": {
          "type": "array",
          "items": { "type": "string", "format": "date-time" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "timeVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:time-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "TIME" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "value": {
          "type": "array",
          "items": { "type": "string", "format": "date-time" },
          "minItems": 0
        }
      }
    },

    "integerScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:integer-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "INTEGER" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "integerVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:integer-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "INTEGER" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "integer" },
          "minItems": 0
        }
      }
    },

    "longScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:long-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "LONG" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": -9223372036854775808,
            "maximum": 9223372036854775807
          },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "longVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:long-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "LONG" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": -9223372036854775808,
            "maximum": 9223372036854775807
          },
          "minItems": 0
        }
      }
    },

    "doubleScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:double-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "DOUBLE" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "doubleVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:double-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "DOUBLE" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 0
        }
      }
    },

    "booleanScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:boolean-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "BOOLEAN" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "boolean" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "booleanVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:boolean-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "BOOLEAN" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "type": "boolean" },
          "minItems": 0
        }
      }
    },

    "dataScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:data-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "DATA" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "$ref": "#/$defs/base64" },
          "minItems": 0,
          "maxItems": 1
        }
      }
    },

    "dataVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "value"],
      "properties": {
        "@type": { "const": "ipto:data-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "DATA" },
        "attrname": { "$ref": "#/$defs/prefixedName" },
        "value": {
          "type": "array",
          "items": { "$ref": "#/$defs/base64" },
          "minItems": 0
        }
      }
    },

    "recordScalar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "attributes"],
      "properties": {
        "@type": { "const": "ipto:record-scalar" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "RECORD" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "attributes": {
          "type": "array",
          "items": { "$ref": "#/$defs/attribute" },
          "minItems": 0
        }
      }
    },

    "recordVector": {
      "type": "object",
      "additionalProperties": false,
      "required": ["@type", "alias", "attrtype", "attrname", "attributes"],
      "properties": {
        "@type": { "const": "ipto:record-vector" },
        "alias": { "type": "string", "minLength": 1 },
        "attrtype": { "const": "RECORD" },
        "attrname": { "$ref": "#/$defs/prefixedName" },

        "attributes": {
          "type": "array",
          "items": { "$ref": "#/$defs/attribute" },
          "minItems": 0
        }
      }
    }
  }
}
